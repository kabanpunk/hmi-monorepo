# HMI Editor Group Operations & Toolbar Implementation Plan

Этот план разбивает требования из спецификации на управляемые задачи. Каждая задача рассчитана на получение работающего, кликабельного интерфейса без ошибок при запуске, допускается мок-логика на ранних этапах. Задачи сгруппированы по областям и имеют примерные зависимости.

## 1. Базовая инфраструктура и режимы редактора

- [ ] Подготовить каркас трёхпанельного макета (левая панель, canvas, правая панель) и верхнего тулбара.
- [ ] Реализовать переключатель режимов Edit / Interactive: отображение тулбара, блокировка редактирования на canvas, включение мок-интерактивности.
- [ ] Добавить заглушки кнопок Load / Save JSON с отображением уведомлений.
- [ ] Настроить статусбар с индикаторами выделения и масштаба.

## 2. Тулбар и группы команд

- [ ] Создать секции тулбара: Text Settings, Align Objects, Distribute Objects, Resize Objects, Grouping, Grid & Guides, Zoom.
- [ ] Настроить dropdown / ring-меню для секций с запоминанием последнего действия.
- [ ] Обработать состояния активности кнопок в зависимости от контекста выделения.
- [ ] Подключить всплывающие подсказки с описанием и хоткеями, а также показывать toast по результату.

## 3. Canvas и взаимодействие с объектами

- [ ] Включить fabric.Canvas с поддержкой одиночного и множественного выделения, drag-перемещения, масштабирования и панорамирования.
- [ ] Реализовать undo/redo стек и снапшоты после действий тулбара.
- [ ] Добавить rulers и guides с возможностью скрывать/показывать и сохранять состояние в JSON.
- [ ] Показать расстояния между объектами при наведении (FR-23) в мок-режиме.

## 4. Группировка объектов

- [ ] Реализовать операции Group / Ungroup / Lock / Unlock / Duplicate, включая поддержку hotkeys.
- [ ] Добавить генерацию groupId, экспорт групп в JSON и вложенность до трёх уровней.
- [ ] Настроить локальный origin для групп и корректную работу Align/Resize.
- [ ] Создать панель Group Properties с редактированием имени, фона, рамки, общих текстовых свойств и кнопок Lock/Hide.

## 5. Выравнивание и распределение

- [ ] Подготовить util-функции align.js и distribute.js для работы с fabric.js объектами.
- [ ] Реализовать Align Left/Right/Top/Bottom/Center/ Middle с поддержкой Align to Canvas и Align to Grid (Alt-модификатор).
- [ ] Настроить Distribute по центрам и краям, Equal Spacing, Compress, игнорирование locked-объектов.
- [ ] Добавить диалог числового ввода интервала для Equal Spacing и превью расстояний.

## 6. Масштабирование размеров

- [ ] Реализовать команды Match Width/Height/Both, Scale To Fit, Set Absolute Width/Height с выбором эталонного объекта.
- [ ] Обновлять размеры групп и дочерних customProps (включая fontSize) при масштабировании.
- [ ] Обработать случаи отсутствующих свойств с уведомлениями.

## 7. Настройки текста

- [ ] Добавить панель Text Settings с полями шрифта, размера, стилей, цвета, выравнивания и межбуквенного/межстрочного интервала.
- [ ] Поддержать применение настроек к одиночным и множественным выделениям, обрабатывать только общие атрибуты.
- [ ] Реализовать color pickers и превью шрифтов (можно мок).

## 8. Сетка, направляющие и снаппинг

- [ ] Включить отображение сетки, настройку шага/цвета/прозрачности, сохранение в JSON.
- [ ] Добавить переключатель snap и временное отключение по Alt.
- [ ] Реализовать drag-добавление направляющих, скрытие/удаление, синхронизацию с JSON.

## 9. Панель слоёв

- [ ] Построить иерархический Layer Manager с drag-and-drop, иконками видимости и блокировки.
- [ ] Настроить контекстное меню (Rename, Duplicate, Delete, Bring Forward/Send Backward).
- [ ] Добавить поиск/фильтр по имени и типу.
- [ ] Обеспечить синхронизацию операций с canvas и undo/redo.

## 10. Горячие клавиши и уведомления

- [ ] Настроить горячие клавиши из спецификации и привязать их к действиям тулбара.
- [ ] Добавить toast уведомления для всех операций и сообщения об ошибках (например, пропущенные свойства).

## 11. Сохранение, загрузка и состояние

- [ ] Реализовать экспорт/импорт JSON со всеми состояниями (объекты, группы, сетка, направляющие, зум, lock/visible).
- [ ] Добавить обработку несовместимых версий и игнорирование неизвестных свойств с логом.
- [ ] Сохранить пользовательские настройки (grid step, zoom, last align action) в localStorage.

## 12. Производительность и визуальные стандарты

- [ ] Оптимизировать операции для выполнения < 100 мс (ленивые снапшоты undo).
- [ ] Подготовить набор иконок в стиле LabVIEW / Material, согласовать размеры и состояния.
- [ ] Проверить единообразие стилей сетки, snaplines, guides, toast и панели слоёв.

## 13. Тестирование и проверка

- [ ] Настроить smoke-тест запуска редактора без ошибок (npm run dev / build).
- [ ] Добавить визуальные тесты ключевых операций (можно мок-сценарии).
- [ ] Документировать сценарии проверки для QA.

